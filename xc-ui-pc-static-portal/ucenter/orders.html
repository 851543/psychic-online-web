<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://localhost:88/static/img/asset-favicon.ico">
    <title>我的订单</title>
    <link rel="stylesheet" href="http://localhost:88/static/plugins/normalize-css/normalize.css" />
    <link rel="stylesheet" href="http://localhost:88/static/plugins/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="http://localhost:88/static/css/page-learing-personal-allclass.css" />
</head>

<body>
<!-- 页面头部 -->
<!--#include virtual="/include/header.html"-->

    <div class="personal-header" style="background-image: url(http://localhost:88/static/img/asset-banner.png);">
        <!--<div class="personal-info">-->
        <!--<p><h1>吴雪</h1></p>-->
        <!--<p>Web前端工程师 学习时长 48小时35分</p>-->
        <!--</div>-->
        <!--<div class="container">-->
        <!--<div class="col-lg-2"><img src="http://localhost:88/static/img/logoIco.png" alt=""></div>-->
        <!--<div class="col-lg-4 title text-left">学习中心</div>-->
        <!--<div class="col-lg-6 text-right"><input type="text" class="input-search" placeholder="输入查询关键词"><input type="submit" class="search-buttom"></div>-->
        <!--</div>-->
    </div>
    <!-- 页面 -->
    <div class="container">
        <div class="personal-nav pull-left" id="ucenterApp">
            <div class="nav nav-stacked text-left">
                <div class="title">个人中心</div>
                <div class="my-ico">
                                        <img :src="user.userpic || 'http://localhost:88/static/img/studyuser.png'" width="140px" height="140px" alt="" style="box-shadow:none">

                    <p>{{ user.name || user.nickname || user.username || '未登录用户' }}</p>
                </div>
                <div class="item">
                   <!--#include virtual="/include/ucenter_menu.html"-->
                </div>
            </div>
        </div>
        <div class="allclass-content pull-right">
            <div class="top-title">
                <span class="active" id="all" @click="setStatus('')">全部课程</span>
                <span id="wait" @click="setStatus('600001')">待付款</span>
                <span id="succ" @click="setStatus('600002')">已完成</span>
                <span id="outs" @click="setStatus('600003')">已关闭</span>
            </div>
            <div class="nav">
                <div><span class="col-md-6">课程信息</span><span class="col-md-4"><em>订单金额</em><em>实付款</em><em>交易状态</em></span><span class="col-md-2">交易操作</span></div>
            </div>
            <div class="content">
                <div class="all show">
                    <div class="allclass-cont">
                        <div class="content">
                            <div class="item" v-for="item in myOrders" :key="item.id">
                                <div class="time-orderid"><span>{{ item.createDate }}</span> 订单号：{{ item.id }}</div>
                                <div class="item-content">
                                    <div class="item-left col-lg-2"><img src="http://localhost:88/static/img/widget-dem.png" width="100%" alt=""></div>
                                    <div class="item-cent col-lg-4">
                                        <div class="title">{{ item.orderName }}</div>
                                        <div class="star-show">
                                            <div class="score"><i></i></div>
                                        </div>
                                        <div class="text">课程打分 <em>4.9星</em></div>
                                        <div class="cont">&nbsp;</div>
                                    </div>
                                    <div class="col-lg-4 lab-info">
                                        <span>${{ item.totalPrice }}</span><span>${{ item.totalPrice }}</span><span>{{ statusText(item.status) }}</span>
                                    </div>
                                    <div class="item-rit col-lg-2">
                                        <template v-if="item.status === '600001'">
                                            <a href="javascript:void(0)" class="">去 支 付 </a>
                                            <a href="javascript:void(0)">取消订单</a>
                                        </template>
                                        <template v-else-if="item.status === '600002'">
                                            <a href="javascript:void(0)" class="class-com">课程评价</a>
                                        </template>
                                        <template v-else>
                                            <span class="undef">——</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="page-item" v-if="myOrders && myOrders.length">
                                <span @click="goPage(1)">首页</span>
                                <span @click="prevPage">上一页</span>
                                <span v-for="p in pages"
                                      :key="p"
                                      :class="{ 'active': p === pageNo }"
                                      @click="goPage(p)">{{ p }}</span>
                                <span @click="nextPage">下一页</span>
                                <span @click="goPage(pages)">尾页</span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="wait">
                    <div class="waitorder-cont">
                        <div class="content">
                            <div class="item" v-for="item in myOrders" :key="item.id">
                                <div class="time-orderid"><span>{{ item.createDate }}</span> 订单号：{{ item.id }}</div>
                                <div class="item-content">
                                    <div class="item-left col-lg-2"><img src="http://localhost:88/static/img/widget-dem.png" width="100%" alt=""></div>
                                    <div class="item-cent col-lg-4">
                                        <div class="title">{{ item.orderName }}</div>
                                        <div class="star-show">
                                            <div class="score"><i></i></div>
                                        </div>
                                        <div class="text">课程打分 <em>4.9星</em></div>
                                        <div class="cont">&nbsp;</div>
                                    </div>
                                    <div class="col-lg-4 lab-info">
                                        <span>${{ item.totalPrice }}</span><span>${{ item.totalPrice }}</span><span>{{ statusText(item.status) }}</span>
                                    </div>
                                    <div class="item-rit col-lg-2">
                                        <template v-if="item.status === '600001'">
                                            <a href="javascript:void(0)" class="">去 支 付 </a>
                                            <a href="javascript:void(0)">取消订单</a>
                                        </template>
                                        <template v-else-if="item.status === '600002'">
                                            <a href="javascript:void(0)" class="class-com">课程评价</a>
                                        </template>
                                        <template v-else>
                                            <span class="undef">——</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="page-item" v-if="myOrders && myOrders.length">
                                <span @click="goPage(1)">首页</span>
                                <span @click="prevPage">上一页</span>
                                <span v-for="p in pages"
                                      :key="p"
                                      :class="{ 'active': p === pageNo }"
                                      @click="goPage(p)">{{ p }}</span>
                                <span @click="nextPage">下一页</span>
                                <span @click="goPage(pages)">尾页</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="succ">
                    <div class="paysucc-cont">
                        <div class="content">
                            <div class="item" v-for="item in myOrders" :key="item.id">
                                <div class="time-orderid"><span>{{ item.createDate }}</span> 订单号：{{ item.id }}</div>
                                <div class="item-content">
                                    <div class="item-left col-lg-2"><img src="http://localhost:88/static/img/widget-dem.png" width="100%" alt=""></div>
                                    <div class="item-cent col-lg-4">
                                        <div class="title">{{ item.orderName }}</div>
                                        <div class="star-show">
                                            <div class="score"><i></i></div>
                                        </div>
                                        <div class="text">课程打分 <em>4.9星</em></div>
                                        <div class="cont">&nbsp;</div>
                                    </div>
                                    <div class="col-lg-4 lab-info">
                                        <span>${{ item.totalPrice }}</span><span>${{ item.totalPrice }}</span><span>{{ statusText(item.status) }}</span>
                                    </div>
                                    <div class="item-rit col-lg-2">
                                        <template v-if="item.status === '600001'">
                                            <a href="javascript:void(0)" class="">去 支 付 </a>
                                            <a href="javascript:void(0)">取消订单</a>
                                        </template>
                                        <template v-else-if="item.status === '600002'">
                                            <a href="javascript:void(0)" class="class-com">课程评价</a>
                                        </template>
                                        <template v-else>
                                            <span class="undef">——</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="page-item" v-if="myOrders && myOrders.length">
                                <span @click="goPage(1)">首页</span>
                                <span @click="prevPage">上一页</span>
                                <span v-for="p in pages"
                                      :key="p"
                                      :class="{ 'active': p === pageNo }"
                                      @click="goPage(p)">{{ p }}</span>
                                <span @click="nextPage">下一页</span>
                                <span @click="goPage(pages)">尾页</span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="outs">
                    <div class="payout-cont">
                        <div class="content">
                            <div class="item" v-for="item in myOrders" :key="item.id">
                                <div class="time-orderid"><span>{{ item.createDate }}</span> 订单号：{{ item.id }} <i class="glyphicon glyphicon-trash"></i></div>
                                <div class="item-content">
                                    <div class="item-left col-lg-2"><img src="http://localhost:88/static/img/widget-dem.png" width="100%" alt=""></div>
                                    <div class="item-cent col-lg-4">
                                        <div class="title">{{ item.orderName }}</div>
                                        <div class="star-show">
                                            <div class="score"><i></i></div>
                                        </div>
                                        <div class="text">课程打分 <em>4.9星</em></div>
                                        <div class="cont">&nbsp;</div>
                                    </div>
                                    <div class="col-lg-4 lab-info">
                                        <span>${{ item.totalPrice }}</span><span>${{ item.totalPrice }}</span><span>{{ statusText(item.status) }}</span>
                                    </div>
                                    <div class="item-rit col-lg-2">
                                        <template v-if="item.status === '600001'">
                                            <a href="javascript:void(0)" class="">去 支 付 </a>
                                            <a href="javascript:void(0)">取消订单</a>
                                        </template>
                                        <template v-else-if="item.status === '600002'">
                                            <a href="javascript:void(0)" class="class-com">课程评价</a>
                                        </template>
                                        <template v-else>
                                            <span class="undef">——</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="page-item" v-if="myOrders && myOrders.length">
                                <span @click="goPage(1)">首页</span>
                                <span @click="prevPage">上一页</span>
                                <span v-for="p in pages"
                                      :key="p"
                                      :class="{ 'active': p === pageNo }"
                                      @click="goPage(p)">{{ p }}</span>
                                <span @click="nextPage">下一页</span>
                                <span @click="goPage(pages)">尾页</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
<!--底部版权-->
<!--#include virtual="/include/footer.html"-->

    <!-- 页面 css js -->
    <script type="text/javascript" src="../plugins/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="../plugins/bootstrap/dist/js/bootstrap.js"></script>
    <script>
        $(function() {
            $(window).scroll(function() {
                if ($(this)[0].scrollY > 235) {
                    $('.personal-nav').css({
                        'position': 'fixed',
                        'top': 10
                    });
                } else if ($(this)[0].scrollY <= 155) {
                    $('.personal-nav').css({
                        'position': 'relative',
                        'top': -70
                    });
                };
            })
            $('.content .cont').map(function(n, i) {
                var text = $(this).text().length
                if (text >= 110) {
                    $(this).text($(this).text().slice(0, 110) + '...')
                }
            })
            $('.top-title span').click(function() {
                $(this).addClass('active').siblings().removeClass('active');
                $('.' + $(this)[0].id).addClass('show').siblings().removeClass('show');
            })
        })
    </script>
    <script>
        /*查询我的订单列表（分页参数拼接在路径上）*/
        const queryMyOrders = (params) => {
            const pageNo = params.pageNo || 1;
            const pageSize = params.pageSize || 4;
            const query = `?pageNo=${pageNo}&pageSize=${pageSize}`;
            // 其余条件作为 body 传递
            const body = Object.assign({}, params);
            delete body.pageNo;
            delete body.pageSize;
            return requestPost('/api/orders/my-list' + query, body);
        }
        // 订单列表 VM
        var ordersVm = new Vue({
            el: '.allclass-content',
            data: {
                params: {
                    status: '',
                    pageNo: 1,
                    pageSize: 4
                },
                myOrders: [],
                pageNo: 1,
                pages: 1
            },
            methods: {
                loadOrders() {
                    queryMyOrders(this.params).then(res => {
                        // 后端返回分页对象时，取 items；如果直接返回数组，可改为 this.myOrders = res
                        this.myOrders = res.items || [];
                        this.pageNo = res.page || this.params.pageNo;
                        this.pages = res.pages || 1;
                    })
                },
                statusText(code) {
                    if (code === '600001') return '待付款';
                    if (code === '600002') return '已完成';
                    if (code === '600003') return '已关闭';
                    return '';
                },
                setStatus(code) {
                    this.params.status = code;
                    this.loadOrders();
                },
                goPage(p) {
                    if (p < 1 || p > this.pages || p === this.pageNo) return;
                    this.params.pageNo = p;
                    this.loadOrders();
                },
                prevPage() {
                    this.goPage(this.pageNo - 1);
                },
                nextPage() {
                    this.goPage(this.pageNo + 1);
                }
            },
            created() {
                this.loadOrders();
            }
        })
    </script>
    <script>
        // 左侧个人信息 VM
        var ucenterVm = new Vue({
            el: '#ucenterApp',
            data: {
                user: {
                    userid: '',
                    username: '',
                    name: '',
                    nickname: '',
                    userpic: ''
                }
            },
            created() {
                var activeUser = getActiveUser();
                if (activeUser) {
                    this.user = activeUser;
                } else {
                    // 未登录则跳转登录页
                    window.location = "http://localhost:88/sign.html?returnUrl=" + Base64.encode(window.location);
                }
            }
        })
    </script>
</body>
</html>
